{"version":3,"sources":["../../src/scripts/keyGenerate.ts","../../src/scripts/content.ts"],"sourcesContent":["export function generateK(length: number = 16): string {\n  const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  const array = new Uint8Array(length);\n  crypto.getRandomValues(array);\n\n  return Array.from(array)\n    .map(byte => charset[byte % charset.length])\n    .join('');\n}\n\nexport async function generateP(userId: string, timestamp: number, key: string): Promise<string> {\n  const encoder = new TextEncoder();\n  const message = encoder.encode(`${userId}:${timestamp}`);\n  const keyData = encoder.encode(key);\n\n  const cryptoKey = await crypto.subtle.importKey(\n    'raw',\n    keyData,\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign']\n  );\n\n  const signature = await crypto.subtle.sign('HMAC', cryptoKey, message);\n\n  return Array.from(new Uint8Array(signature))\n    .map(byte => byte.toString(16).padStart(2, '0'))\n    .join('');\n}\n\nexport async function generateKey() {\n  const u = 'user123';\n  const t = Math.floor(Date.now() / 1000);\n  const k = generateK();\n\n  const p = await generateP(u, t, k);\n\n  return p;\n}\n","import { generateKey } from \"./keyGenerate\";\n\nlet currentTrackingId: string = \"\";\nfunction interceptGmailSend() {\n  const sendButton = document.querySelector(\n    \"div.T-I.J-J5-Ji.aoO.v7.T-I-atl.L3\"\n  ) as HTMLElement | null;\n\n  if (!sendButton || sendButton.dataset.trackerInjected === \"true\") return;\n\n  sendButton.dataset.trackerInjected = \"true\";\n\n  const clonedButton = sendButton.cloneNode(true) as HTMLElement;\n  sendButton.replaceWith(clonedButton);\n\n  clonedButton.addEventListener(\"click\", async function handler(e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    clonedButton.removeEventListener(\"click\", handler);\n\n    if (currentTrackingId) {\n      try {\n        // const token = localStorage.getItem(\"authToken\");\n        const token =\n          \"eyJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiI2N2Y5OTAzZWZmZTE5MTNiYjNhNTMwYzciLCJzdWIiOiJrc2hpdGlqQGdtYWlsLmNvbSIsImlhdCI6MTc0Nzc3MzAwNiwiZXhwIjoxNzQ5NTczMDA2fQ.V_qOXf2YtasJx6Ne6zLLwOJD22kzI6hpy0CCH5QZciI\";\n\n        await fetch(\"http://localhost:8080/tracking/ids\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${token}`,\n          },\n          body: currentTrackingId,\n        });\n        console.log(\"âœ… Tracking ID uploaded to server\");\n      } catch (error) {\n        console.error(\"âŒ Failed to upload tracking ID\", error);\n      }\n    }\n\n    sendButton.click();\n  });\n}\n\nfunction insertImageIntoEmail() {\n  const composeButton = document.querySelector(\n    \".T-I.T-I-KE.L3\"\n  ) as HTMLElement | null;\n\n  if (composeButton && !composeButton.dataset.trackerRenamed) {\n    composeButton.dataset.trackerRenamed = \"true\";\n  }\n\n  if (!composeButton || composeButton.dataset.trackerInjected === \"true\")\n    return;\n\n  composeButton.dataset.trackerInjected = \"true\";\n\n  console.log(\"get inside insertImageIntoEmail ðŸ˜Ž \", composeButton);\n  const redPixelBase64 =\n    \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAIElEQVQoU2NkYGBgYGBg+M+ABCEGBgYGJRYwGoaYBgB2hAFZkIo12gAAAABJRU5ErkJggg==\";\n\n  composeButton.addEventListener(\"click\", async function handler(e) {\n    currentTrackingId = await generateKey();\n    console.log(\"ðŸ“¦ Tracked value:\", currentTrackingId);\n    const trackingUrl = `http://localhost:8080/track/${currentTrackingId}`;\n\n    setTimeout(() => {\n      const emailBodies = document.querySelectorAll(\n        '[aria-label=\"Message Body\"]'\n      );\n\n      emailBodies.forEach((body) => {\n        const htmlBody = body as HTMLElement;\n\n        if (htmlBody.dataset.pixelInjected === \"true\") return;\n        htmlBody.dataset.pixelInjected = \"true\";\n\n        const img = document.createElement(\"img\");\n        img.src = trackingUrl;\n        img.width = 10;\n        img.height = 10;\n        img.style.backgroundColor = \"red\";\n        img.style.border = \"1px solid black\";\n        img.style.display = \"inline-block\";\n        img.alt = \"debug pixel\";\n\n        htmlBody.appendChild(img);\n        console.log(\"ðŸ–¼ï¸ Tracking pixel injected\");\n      });\n    }, 300);\n  });\n}\n\nfunction highlightGmailHeader() {\n  const headerBar = document.querySelector(\"header\");\n\n  if (headerBar && !headerBar.dataset.extModified) {\n    headerBar.style.backgroundColor = \"#FFBE98\";\n    headerBar.dataset.extModified = \"true\";\n    console.log(\"ðŸŸ§ Mail Tracker extension active â€“ header modified\");\n  }\n}\n\nconst sendButtonObserver = new MutationObserver(() => {\n  interceptGmailSend();\n});\n\nsendButtonObserver.observe(document.body, {\n  childList: true,\n  subtree: true,\n});\n\nconst headerObserver = new MutationObserver(() => {\n  highlightGmailHeader();\n});\n\nheaderObserver.observe(document.body, {\n  childList: true,\n  subtree: true,\n});\n\nconst insertImageIntoEmailObserver = new MutationObserver(() => {\n  insertImageIntoEmail();\n});\n\ninsertImageIntoEmailObserver.observe(document.body, {\n  childList: true,\n  subtree: true,\n});\n\nwindow.addEventListener(\"load\", () => {\n  interceptGmailSend();\n  highlightGmailHeader();\n  insertImageIntoEmail();\n});\n"],"mappings":"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","names":[]}